import{V as l,ai as M,C as P,W as v,aj as L,ak as E,al as b,x,am as S,D as u,an as C,ao as A,a as I}from"./three-BVjbcvq7.js";import{O as z,G as m}from"./three-examples-XOVWs6lz.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))s(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const n of i.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&s(n)}).observe(document,{childList:!0,subtree:!0});function t(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerPolicy&&(i.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?i.credentials="include":o.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(o){if(o.ep)return;o.ep=!0;const i=t(o);fetch(o.href,i)}})();class T{constructor(){this.initialize(),this.setupCameraPositions(),this.totalAssets=7,this.loadedAssets=0,this.cloudInitialPositions=[]}setupCameraPositions(){this.cameraPositions={work:{position:new l(30,25,30),target:new l(0,0,0)},skills:{position:new l(0,40,0),target:new l(0,0,0)}},this.camera.position.set(45,20,8),this.controls.minDistance=25,this.controls.maxDistance=70,this.controls.minPolarAngle=Math.PI*.2,this.controls.maxPolarAngle=Math.PI*.6,this.controls.target.set(0,0,0),this.controls.update(),window.addEventListener("updateCamera",e=>{this.animateCamera(e.detail.section)})}animateCamera(e){if(!this.cameraPositions[e])return;const t=this.cameraPositions[e].position,s=this.cameraPositions[e].target;this.controls.enabled=!1;const o={x:this.camera.position.x,y:this.camera.position.y,z:this.camera.position.z},i=2e3,n=Date.now(),a=()=>{const c=Date.now()-n,r=Math.min(c/i,1),d=this.easeInOutCubic(r);this.camera.position.lerpVectors(new l(o.x,o.y,o.z),t,d),this.camera.lookAt(s.x*d,s.y*d,s.z*d),r<1?requestAnimationFrame(a):(this.controls.enabled=!0,this.controls.target.copy(s))};a()}easeInOutCubic(e){return e<.5?4*e*e*e:1-Math.pow(-2*e+2,3)/2}initialize(){try{this.scene=new M,this.scene.background=new P(8900331),this.camera=new v(75,window.innerWidth/window.innerHeight,.1,1e3);const e=45,t=25*Math.PI/180,s=e*Math.cos(t),o=e*Math.sin(t);this.camera.position.set(s,20,o),this.camera.lookAt(0,0,0),this.renderer=new L({canvas:document.querySelector("#world"),antialias:!0,powerPreference:"high-performance",alpha:!0}),this.renderer.setSize(window.innerWidth,window.innerHeight),this.renderer.setPixelRatio(Math.min(window.devicePixelRatio,2)),this.renderer.shadowMap.enabled=!0,this.renderer.shadowMap.type=E,this.renderer.physicallyCorrectLights=!0,this.setupPerformanceMonitoring(),this.setupLights(),this.controls=new z(this.camera,this.renderer.domElement),this.controls.enableDamping=!0,this.controls.dampingFactor=.05,this.controls.maxPolarAngle=Math.PI/2.1,this.controls.minDistance=10,this.controls.maxDistance=60,this.controls.autoRotate=!1,this.controls.target.set(0,0,0),this.loadedAssets=0,this.loadIsland(),this.loadPlane(),this.loadClouds(),window.addEventListener("resize",()=>this.onWindowResize()),window.addEventListener("orientationchange",()=>{setTimeout(()=>this.onWindowResize(),100)}),this.setupTouchEvents(),this.onWindowResize(),this.animate(),this.updateLoadingProgress(),this.setupMobileControls()}catch(e){console.error("初始化错误:",e),this.showError()}}setupMobileControls(){if(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)){this.renderer.setPixelRatio(Math.min(window.devicePixelRatio,1.5)),this.camera.position.set(50,25,12),this.controls.minDistance=35,this.controls.maxDistance=65,this.controls.autoRotate=!1,this.controls.enableDamping=!0,this.controls.dampingFactor=.05,this.controls.rotateSpeed=.5,this.controls.zoomSpeed=.5,this.controls.minPolarAngle=Math.PI*.25,this.controls.maxPolarAngle=Math.PI*.55,this.renderer.domElement.addEventListener("touchstart",i=>{i.touches.length===2&&i.preventDefault()},{passive:!1});let t=0,s=0,o=!1;this.renderer.domElement.addEventListener("touchstart",i=>{i.touches.length===1&&(t=i.touches[0].clientX,s=i.touches[0].clientY,o=!1)}),this.renderer.domElement.addEventListener("touchmove",i=>{if(i.touches.length===1){const n=i.touches[0].clientX,a=i.touches[0].clientY,c=n-t,r=a-s;(Math.abs(c)>5||Math.abs(r)>5)&&(o=!0),t=n,s=a}}),this.renderer.domElement.addEventListener("touchend",i=>{if(!o&&i.changedTouches.length===1){const n=this.renderer.domElement.getBoundingClientRect(),a=(i.changedTouches[0].clientX-n.left)/n.width*2-1,c=-((i.changedTouches[0].clientY-n.top)/n.height)*2+1;this.handleTouchClick(a,c)}})}}handleTouchClick(e,t){const s=new b,o=new I(e,t);s.setFromCamera(o,this.camera);const i=s.intersectObjects(this.scene.children,!0);if(i.length>0){const n=i[0].object;n===this.plane?(this.plane.scale.set(1.1,1.1,1.1),setTimeout(()=>{this.plane.scale.set(1,1,1)},200)):n===this.island&&(this.island.rotation.y+=Math.PI/4)}}updateLoadingProgress(){this.loadedAssets++;const e=Math.round(this.loadedAssets/this.totalAssets*100),t=document.getElementById("loading-progress");t&&(t.textContent=`${e}%`),this.loadedAssets>=this.totalAssets&&this.hideLoadingScreen()}hideLoadingScreen(){const e=document.getElementById("loading-screen");e&&(e.classList.add("loading-screen-fade"),setTimeout(()=>{e.style.display="none"},500))}setupPerformanceMonitoring(){this.lastTime=performance.now(),this.frameCount=0,this.lastFPS=0,window.performance&&window.performance.memory&&(this.memoryInfo=window.performance.memory)}loadIsland(){new m().load("/3d_portfolio/models/foxs_islands.glb",s=>{this.island=s.scene,this.island.rotation.y=Math.PI,this.scene.add(this.island),this.updateLoadingProgress()},s=>{const o=Math.round(s.loaded/s.total*100);console.log("Island loading:",o+"%")},s=>{console.error("加载模型时出错:",s),this.showError()})}loadPlane(){new m().load("/3d_portfolio/models/cartoon_plane.glb",s=>{this.plane=s.scene,this.plane.scale.set(.5,.5,.5),this.plane.position.set(25,15,0),this.plane.rotation.set(0,Math.PI/2,0),this.planeStartTime=Date.now(),this.scene.add(this.plane),this.updateLoadingProgress()},s=>{const o=Math.round(s.loaded/s.total*100);console.log("Plane loading:",o+"%")},s=>{console.error("加载飞机模型时出错:",s)})}loadClouds(){const e=new m;this.clouds=[];const t=[{x:-45,y:38,z:-30,speed:.003},{x:-32.5,y:42,z:-52.5,speed:.002},{x:-90.5,y:40.5,z:-15,speed:.0015},{x:-75,y:37.5,z:50,speed:.0015},{x:-15,y:45,z:-150,speed:.0015}];t.forEach((s,o)=>{e.load("/3d_portfolio/models/clouds.glb",n=>{const a=n.scene,c=1.2+Math.random()*.6;a.scale.set(c,c,c),a.position.set(s.x,s.y,s.z),a.traverse(r=>{r.isMesh&&(r.material.transparent=!0,r.material.opacity=.9,r.castShadow=!1,r.receiveShadow=!1,r.material.needsUpdate=!1,r.material.side=x)}),a.userData={speed:s.speed,initialX:s.x,movingRight:Math.random()>.5,offset:Math.random()*Math.PI*2},this.clouds.push(a),this.scene.add(a),this.clouds.length===t.length&&this.initCloudPositions(),this.updateLoadingProgress()},n=>{const a=Math.round(n.loaded/n.total*100);console.log("Cloud loading:",a+"%")},n=>{console.error("加载云朵模型时出错:",n)})})}initCloudPositions(){this.cloudInitialPositions=this.clouds.map(e=>({x:e.position.x,y:e.position.y,z:e.position.z}))}setupLights(){const e=new S(16777215,.3);this.scene.add(e);const t=new u(16777215,2.5);t.position.set(10,10,10),t.castShadow=!0,t.shadow.camera.left=-15,t.shadow.camera.right=15,t.shadow.camera.top=15,t.shadow.camera.bottom=-15,t.shadow.mapSize.width=2048,t.shadow.mapSize.height=2048,t.shadow.bias=-.001,this.scene.add(t);const s=new u(10401023,.5);s.position.set(-10,5,-10),this.scene.add(s),this.renderer.toneMapping=C,this.renderer.toneMappingExposure=1,this.renderer.outputEncoding=A}onWindowResize(){this.camera.aspect=window.innerWidth/window.innerHeight,this.camera.updateProjectionMatrix(),this.renderer.setSize(window.innerWidth,window.innerHeight),window.innerWidth<=768?(this.camera.position.set(50,25,12),this.controls.minDistance=15,this.controls.maxDistance=45):window.innerWidth<=1024?(this.camera.position.set(45,20,8),this.controls.minDistance=12,this.controls.maxDistance=40):(this.camera.position.set(40,18,5),this.controls.minDistance=10,this.controls.maxDistance=55),this.controls.target.set(0,0,0),this.controls.update()}setupTouchEvents(){let e=0,t=0;this.renderer.domElement.addEventListener("touchstart",s=>{e=s.touches[0].clientX,t=s.touches[0].clientY}),this.renderer.domElement.addEventListener("touchmove",s=>{if(s.touches.length===1){const o=s.touches[0].clientX,i=s.touches[0].clientY,n=o-e,a=i-t;this.camera.position.x+=n*.01,this.camera.position.y-=a*.01,e=o,t=i}})}animate(){requestAnimationFrame(()=>this.animate()),this.frameCount++;const e=performance.now();if(e>this.lastTime+1e3&&(this.lastFPS=this.frameCount,this.frameCount=0,this.lastTime=e,this.lastFPS<30&&this.renderer.setPixelRatio(1)),this.controls.update(),this.plane){const t=(Date.now()-this.planeStartTime)*.001,s=25,o=.3,i=15,n=t*o,a=Math.cos(n)*s,c=Math.sin(n)*s;this.plane.position.set(a,i+Math.sin(t*2)*.5,c);const r=n+.1,d=Math.cos(r)*s,g=Math.sin(r)*s,h=new l(d-a,0,g-c);h.normalize();const w=new l(this.plane.position.x+h.x,this.plane.position.y,this.plane.position.z+h.z);this.plane.lookAt(w);const f=Math.PI*.1;this.plane.rotation.clone(),this.plane.rotateZ(f);const y=Math.sin(t*2)*.05;this.plane.rotateX(y)}if(this.clouds&&this.clouds.forEach((t,s)=>{const o=Date.now()*.001,i=.5+s*.1;t.position.y+=Math.sin(o*i)*.01,t.position.x=this.cloudInitialPositions[s].x+Math.sin(o*.2)*2,t.rotation.y=Math.sin(o*.1)*.1;const n=1+Math.sin(o*.5)*.05;t.scale.set(n,n,n)}),this.island){const t=Date.now()*.001;this.island.position.y=Math.sin(t*.5)*.2,this.island.rotation.y=Math.sin(t*.2)*.05}this.renderer.render(this.scene,this.camera)}showError(){const e=document.getElementById("loading-screen");e&&(e.innerHTML='<div class="error">加载出错，请刷新页面重试</div>')}}class D{constructor(){this.modals={intro:document.getElementById("introModal"),about:document.getElementById("aboutModal"),work:document.getElementById("workModal"),skills:document.getElementById("skillsModal")},this.activeModal=null,this.setupEventListeners()}setupEventListeners(){document.querySelectorAll(".close-modal").forEach(t=>{t.addEventListener("click",()=>this.closeActiveModal())});const e=document.querySelectorAll(".nav-item");e.forEach(t=>{t.addEventListener("click",s=>{const o=t.getAttribute("data-section");o&&(e.forEach(i=>i.classList.remove("active")),t.classList.add("active"),this.openModal(o))})}),window.addEventListener("click",t=>{this.activeModal&&!t.target.closest(".modal-content")&&!t.target.closest(".nav-item")&&this.closeActiveModal()})}openModal(e){this.activeModal&&this.closeActiveModal();const t=this.modals[e];t&&(t.classList.add("active"),this.activeModal=t)}closeActiveModal(){this.activeModal&&(this.activeModal.classList.remove("active"),this.activeModal=null)}showModalContent(e){const t=document.querySelector(".modal"),s=t.querySelector(".modal-content"),o=t.querySelector(".modal-title"),i=t.querySelector(".modal-body");o.textContent="",i.innerHTML="";const n=this.modalContents[e];n&&(o.textContent=n.title,i.innerHTML=n.body),gsap.fromTo(s,{opacity:0,y:20,scale:.9},{opacity:1,y:0,scale:1,duration:.2,ease:"power1.out"}),gsap.fromTo(o,{opacity:0,y:5},{opacity:1,y:0,duration:.1,delay:.05}),gsap.fromTo(i,{opacity:0,y:5},{opacity:1,y:0,duration:.1,delay:.1}),t.style.display="flex",gsap.to(t,{opacity:1,duration:.15,ease:"power1.out"})}hideModal(){const e=document.querySelector(".modal");gsap.to(e,{opacity:0,duration:.15,ease:"power1.in",onComplete:()=>{e.style.display="none"}})}}new T;new D;
